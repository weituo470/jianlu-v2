{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// HTTP请求工具\nimport envConfig from '../config/env.js'\n\nconst BASE_URL = envConfig.API_BASE_URL\n\n// 请求拦截器\nconst request = (options) => {\n\treturn new Promise((resolve, reject) => {\n\t\t// 添加token\n\t\tconst token = uni.getStorageSync('token')\n\t\tconst header = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t...options.header\n\t\t}\n\t\t\n\t\tif (token) {\n\t\t\theader.Authorization = `Bearer ${token}`\n\t\t}\n\t\t\n\t\tconst fullUrl = BASE_URL + options.url\n\t\tconsole.log('发送请求:', {\n\t\t\turl: fullUrl,\n\t\t\tmethod: options.method || 'GET',\n\t\t\tdata: options.data,\n\t\t\theader\n\t\t})\n\n\t\tuni.request({\n\t\t\turl: fullUrl,\n\t\t\tmethod: options.method || 'GET',\n\t\t\tdata: options.data || {},\n\t\t\theader,\n\t\t\tsuccess: (res) => {\n\t\t\t\tconsole.log('请求响应:', {\n\t\t\t\t\turl: fullUrl,\n\t\t\t\t\tstatusCode: res.statusCode,\n\t\t\t\t\tdata: res.data\n\t\t\t\t})\n\n\t\t\t\t// 处理响应\n\t\t\t\tif (res.statusCode >= 200 && res.statusCode < 300) {\n\t\t\t\t\t// 2xx状态码都认为是成功\n\t\t\t\t\tresolve(res.data)\n\t\t\t\t} else if (res.statusCode === 401) {\n\t\t\t\t\t// token过期，清除本地存储并跳转登录\n\t\t\t\t\tuni.removeStorageSync('token')\n\t\t\t\t\tuni.removeStorageSync('userInfo')\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t})\n\t\t\t\t\treject(new Error('登录已过期'))\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('请求失败:', res)\n\t\t\t\t\treject(new Error(res.data?.message || `请求失败 (${res.statusCode})`))\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('网络请求失败:', {\n\t\t\t\t\turl: fullUrl,\n\t\t\t\t\terror: err\n\t\t\t\t})\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '网络请求失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treject(new Error(`网络请求失败: ${err.errMsg || '未知错误'}`))\n\t\t\t}\n\t\t})\n\t})\n}\n\n// GET请求\nexport const get = (url, data = {}) => {\n\treturn request({\n\t\turl,\n\t\tmethod: 'GET',\n\t\tdata\n\t})\n}\n\n// POST请求\nexport const post = (url, data = {}) => {\n\treturn request({\n\t\turl,\n\t\tmethod: 'POST',\n\t\tdata\n\t})\n}\n\n// PUT请求\nexport const put = (url, data = {}) => {\n\treturn request({\n\t\turl,\n\t\tmethod: 'PUT',\n\t\tdata\n\t})\n}\n\n// DELETE请求\nexport const del = (url, data = {}) => {\n\treturn request({\n\t\turl,\n\t\tmethod: 'DELETE',\n\t\tdata\n\t})\n}\n\nexport default request\n"],"names":["envConfig","uni"],"mappings":";;;AAGA,MAAM,WAAWA,WAAS,UAAC;AAG3B,MAAM,UAAU,CAAC,YAAY;AAC5B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEvC,UAAM,QAAQC,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,SAAS;AAAA,MACd,gBAAgB;AAAA,MAChB,GAAG,QAAQ;AAAA,IACX;AAED,QAAI,OAAO;AACV,aAAO,gBAAgB,UAAU,KAAK;AAAA,IACtC;AAED,UAAM,UAAU,WAAW,QAAQ;AACnCA,kBAAAA,MAAY,MAAA,OAAA,0BAAA,SAAS;AAAA,MACpB,KAAK;AAAA,MACL,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ;AAAA,MACd;AAAA,IACH,CAAG;AAEDA,kBAAAA,MAAI,QAAQ;AAAA,MACX,KAAK;AAAA,MACL,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,MACxB;AAAA,MACA,SAAS,CAAC,QAAQ;;AACjBA,sBAAAA,MAAA,MAAA,OAAA,0BAAY,SAAS;AAAA,UACpB,KAAK;AAAA,UACL,YAAY,IAAI;AAAA,UAChB,MAAM,IAAI;AAAA,QACf,CAAK;AAGD,YAAI,IAAI,cAAc,OAAO,IAAI,aAAa,KAAK;AAElD,kBAAQ,IAAI,IAAI;AAAA,QACrB,WAAe,IAAI,eAAe,KAAK;AAElCA,wBAAG,MAAC,kBAAkB,OAAO;AAC7BA,wBAAG,MAAC,kBAAkB,UAAU;AAChCA,wBAAAA,MAAI,SAAS;AAAA,YACZ,KAAK;AAAA,UACX,CAAM;AACD,iBAAO,IAAI,MAAM,OAAO,CAAC;AAAA,QAC9B,OAAW;AACNA,wBAAAA,MAAA,MAAA,SAAA,0BAAc,SAAS,GAAG;AAC1B,iBAAO,IAAI,QAAM,SAAI,SAAJ,mBAAU,YAAW,SAAS,IAAI,UAAU,GAAG,CAAC;AAAA,QACjE;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACdA,sBAAAA,MAAA,MAAA,SAAA,0BAAc,WAAW;AAAA,UACxB,KAAK;AAAA,UACL,OAAO;AAAA,QACZ,CAAK;AACDA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACX,CAAK;AACD,eAAO,IAAI,MAAM,WAAW,IAAI,UAAU,MAAM,EAAE,CAAC;AAAA,MACnD;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAGY,MAAC,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACF,CAAE;AACF;AAGY,MAAC,OAAO,CAAC,KAAK,OAAO,OAAO;AACvC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACF,CAAE;AACF;AAGY,MAAC,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACF,CAAE;AACF;AAGY,MAAC,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACF,CAAE;AACF;;;;;"}