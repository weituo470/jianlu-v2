{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// HTTP请求工具\r\nimport envConfig from '../config/env.js'\r\n\r\nconst BASE_URL = envConfig.API_BASE_URL\r\n\r\n// 请求拦截器\r\nconst request = (options) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\t// 添加token\r\n\t\tconst token = uni.getStorageSync('token')\r\n\t\tconst header = {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t...options.header\r\n\t\t}\r\n\t\t\r\n\t\tif (token) {\r\n\t\t\theader.Authorization = `Bearer ${token}`\r\n\t\t}\r\n\t\t\r\n\t\t// 处理GET请求的查询参数\r\n\t\tlet fullUrl = BASE_URL + options.url\r\n\t\tlet requestData = options.data || {}\r\n\r\n\t\t// 如果是GET请求且有参数，将参数添加到URL中\r\n\t\tif ((options.method || 'GET') === 'GET' && Object.keys(requestData).length > 0) {\r\n\t\t\t// 手动构建查询字符串，兼容小程序环境\r\n\t\t\tconst queryString = Object.keys(requestData)\r\n\t\t\t\t.map(key => {\r\n\t\t\t\t\tconst value = requestData[key]\r\n\t\t\t\t\tif (value === null || value === undefined) return ''\r\n\t\t\t\t\treturn `${encodeURIComponent(key)}=${encodeURIComponent(value)}`\r\n\t\t\t\t})\r\n\t\t\t\t.filter(Boolean)\r\n\t\t\t\t.join('&')\r\n\r\n\t\t\tif (queryString) {\r\n\t\t\t\tfullUrl += (fullUrl.includes('?') ? '&' : '?') + queryString\r\n\t\t\t}\r\n\t\t\trequestData = {} // GET请求的参数已经添加到URL中，清空data\r\n\t\t}\r\n\r\n\t\t// 开发环境才打印详细请求日志\r\n\t\tif (process.env.NODE_ENV === 'development') {\r\n\t\t\tconsole.log('发送请求:', {\r\n\t\t\t\turl: fullUrl,\r\n\t\t\t\tmethod: options.method || 'GET',\r\n\t\t\t\tdata: requestData,\r\n\t\t\t\theader\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tuni.request({\r\n\t\t\turl: fullUrl,\r\n\t\t\tmethod: options.method || 'GET',\r\n\t\t\tdata: requestData,\r\n\t\t\theader,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t// 开发环境才打印详细响应日志\r\n\t\t\tif (process.env.NODE_ENV === 'development') {\r\n\t\t\t\tconsole.log('请求响应:', {\r\n\t\t\t\t\turl: fullUrl,\r\n\t\t\t\t\tstatusCode: res.statusCode,\r\n\t\t\t\t\tdata: res.data\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\t\t// 处理响应\r\n\t\t\t\tif (res.statusCode >= 200 && res.statusCode < 300) {\r\n\t\t\t\t\t// 2xx状态码都认为是成功\r\n\t\t\t\t\tresolve(res.data)\r\n\t\t\t\t} else if (res.statusCode === 401) {\r\n\t\t\t\t\t// token过期，清除本地存储并跳转登录\r\n\t\t\t\t\tuni.removeStorageSync('token')\r\n\t\t\t\t\tuni.removeStorageSync('userInfo')\r\n\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treject(new Error('登录已过期'))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('请求失败:', res)\r\n\t\t\t\t\treject(new Error(res.data?.message || `请求失败 (${res.statusCode})`))\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.error('网络请求失败:', {\r\n\t\t\t\t\turl: fullUrl,\r\n\t\t\t\t\terror: err\r\n\t\t\t\t})\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '网络请求失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treject(new Error(`网络请求失败: ${err.errMsg || '未知错误'}`))\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\n// GET请求\r\nexport const get = (url, data = {}) => {\r\n\treturn request({\r\n\t\turl,\r\n\t\tmethod: 'GET',\r\n\t\tdata\r\n\t})\r\n}\r\n\r\n// POST请求\r\nexport const post = (url, data = {}) => {\r\n\treturn request({\r\n\t\turl,\r\n\t\tmethod: 'POST',\r\n\t\tdata\r\n\t})\r\n}\r\n\r\n// PUT请求\r\nexport const put = (url, data = {}) => {\r\n\treturn request({\r\n\t\turl,\r\n\t\tmethod: 'PUT',\r\n\t\tdata\r\n\t})\r\n}\r\n\r\n// DELETE请求\r\nexport const del = (url, data = {}) => {\r\n\treturn request({\r\n\t\turl,\r\n\t\tmethod: 'DELETE',\r\n\t\tdata\r\n\t})\r\n}\r\n\r\nexport default request\r\n"],"names":["envConfig","uni"],"mappings":";;;AAGA,MAAM,WAAWA,WAAU,UAAA;AAG3B,MAAM,UAAU,CAAC,YAAY;AAC5B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEjC,UAAA,QAAQC,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,SAAS;AAAA,MACd,gBAAgB;AAAA,MAChB,GAAG,QAAQ;AAAA,IAAA;AAGZ,QAAI,OAAO;AACH,aAAA,gBAAgB,UAAU,KAAK;AAAA,IACvC;AAGI,QAAA,UAAU,WAAW,QAAQ;AAC7B,QAAA,cAAc,QAAQ,QAAQ;AAG7B,SAAA,QAAQ,UAAU,WAAW,SAAS,OAAO,KAAK,WAAW,EAAE,SAAS,GAAG;AAE/E,YAAM,cAAc,OAAO,KAAK,WAAW,EACzC,IAAI,CAAO,QAAA;AACL,cAAA,QAAQ,YAAY,GAAG;AACzB,YAAA,UAAU,QAAQ,UAAU;AAAkB,iBAAA;AAClD,eAAO,GAAG,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,KAAK,CAAC;AAAA,MAC9D,CAAA,EACA,OAAO,OAAO,EACd,KAAK,GAAG;AAEV,UAAI,aAAa;AAChB,oBAAY,QAAQ,SAAS,GAAG,IAAI,MAAM,OAAO;AAAA,MAClD;AACA,oBAAc,CAAA;AAAA,IACf;AAG4C;AAC/BA,oBAAAA,MAAA,MAAA,OAAA,0BAAA,SAAS;AAAA,QACpB,KAAK;AAAA,QACL,QAAQ,QAAQ,UAAU;AAAA,QAC1B,MAAM;AAAA,QACN;AAAA,MAAA,CACA;AAAA,IACF;AAEAA,kBAAAA,MAAI,QAAQ;AAAA,MACX,KAAK;AAAA,MACL,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM;AAAA,MACN;AAAA,MACA,SAAS,CAAC,QAAQ;;AAE0B;AAC3CA,wBAAAA,MAAA,MAAA,OAAA,0BAAY,SAAS;AAAA,YACpB,KAAK;AAAA,YACL,YAAY,IAAI;AAAA,YAChB,MAAM,IAAI;AAAA,UAAA,CACV;AAAA,QACF;AAGC,YAAI,IAAI,cAAc,OAAO,IAAI,aAAa,KAAK;AAElD,kBAAQ,IAAI,IAAI;AAAA,QAAA,WACN,IAAI,eAAe,KAAK;AAElCA,8BAAI,kBAAkB,OAAO;AAC7BA,8BAAI,kBAAkB,UAAU;AAChCA,wBAAAA,MAAI,SAAS;AAAA,YACZ,KAAK;AAAA,UAAA,CACL;AACM,iBAAA,IAAI,MAAM,OAAO,CAAC;AAAA,QAAA,OACnB;AACNA,wBAAA,MAAc,MAAA,SAAA,0BAAA,SAAS,GAAG;AACnB,iBAAA,IAAI,QAAM,SAAI,SAAJ,mBAAU,YAAW,SAAS,IAAI,UAAU,GAAG,CAAC;AAAA,QAClE;AAAA,MACD;AAAA,MACA,MAAM,CAAC,QAAQ;AACAA,sBAAAA,MAAA,MAAA,SAAA,0BAAA,WAAW;AAAA,UACxB,KAAK;AAAA,UACL,OAAO;AAAA,QAAA,CACP;AACDA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD,eAAO,IAAI,MAAM,WAAW,IAAI,UAAU,MAAM,EAAE,CAAC;AAAA,MACpD;AAAA,IAAA,CACA;AAAA,EAAA,CACD;AACF;AAGO,MAAM,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EAAA,CACA;AACF;AAGO,MAAM,OAAO,CAAC,KAAK,OAAO,OAAO;AACvC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EAAA,CACA;AACF;AAGO,MAAM,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EAAA,CACA;AACF;AAGO,MAAM,MAAM,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACd;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EAAA,CACA;AACF;;;;;"}