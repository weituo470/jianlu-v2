{"version":3,"file":"activity.js","sources":["api/activity.js"],"sourcesContent":["import { get, post, put, del } from '../utils/request.js'\r\n\r\n// 活动API接口（使用小程序专用API）\r\nexport const activityApi = {\r\n  // 获取活动列表\r\n  getList(params = {}) {\r\n    return get('/miniapp/activities', params)\r\n  },\r\n\r\n  // 获取活动详情\r\n  getDetail(id) {\r\n    return get(`/miniapp/activities/${id}`)\r\n  },\r\n\r\n  // 创建活动\r\n  create(data) {\r\n    return post('/miniapp/activities', data)\r\n  },\r\n\r\n  // 更新活动\r\n  update(id, data) {\r\n    return put(`/miniapp/activities/${id}`, data)\r\n  },\r\n\r\n  // 删除活动\r\n  delete(id) {\r\n    return del(`/miniapp/activities/${id}`)\r\n  },\r\n\r\n  // 报名活动\r\n  register(id, data) {\r\n    return post(`/miniapp/activities/${id}/register`, data)\r\n  },\r\n\r\n  // 取消报名\r\n  cancelRegistration(id) {\r\n    return del(`/miniapp/activities/${id}/register`)\r\n  },\r\n\r\n  // 获取我的报名列表\r\n  getMyRegistrations(params = {}) {\r\n    return get('/miniapp/my-registrations', params)\r\n  },\r\n\r\n  // 获取活动报名列表（管理员）\r\n  getRegistrations(id, params = {}) {\r\n    return get(`/miniapp/activities/${id}/registrations`, params)\r\n  },\r\n\r\n  // 审核报名（管理员）\r\n  approveRegistration(registrationId, approved = true) {\r\n    return post(`/miniapp/registrations/${registrationId}/approve`, { approved })\r\n  },\r\n\r\n  // 批量审核报名（管理员）\r\n  batchApproveRegistrations(registrationIds, approved = true) {\r\n    return post('/miniapp/registrations/batch-approve', { \r\n      registration_ids: registrationIds, \r\n      approved \r\n    })\r\n  }\r\n}\r\n\r\n// 活动类型配置\r\nexport const activityTypes = {\r\n  travel: {\r\n    name: '旅游活动',\r\n    icon: '🏖️',\r\n    color: '#FF6B6B',\r\n    description: '团建旅行、户外探险等'\r\n  },\r\n  meeting: {\r\n    name: '会议活动', \r\n    icon: '💼',\r\n    color: '#4ECDC4',\r\n    description: '技术分享、工作会议等'\r\n  },\r\n  social: {\r\n    name: '社交活动',\r\n    icon: '🎉',\r\n    color: '#45B7D1',\r\n    description: '聚餐、娱乐等'\r\n  },\r\n  learning: {\r\n    name: '学习活动',\r\n    icon: '📚',\r\n    color: '#96CEB4',\r\n    description: '培训、讲座等'\r\n  },\r\n  sports: {\r\n    name: '运动活动',\r\n    icon: '⚽',\r\n    color: '#FFEAA7',\r\n    description: '健身、比赛等'\r\n  },\r\n  other: {\r\n    name: '其它',\r\n    icon: '📋',\r\n    color: '#BDC3C7',\r\n    description: '其它类型的活动'\r\n  }\r\n}\r\n\r\n// 活动状态配置\r\nexport const activityStatus = {\r\n  draft: {\r\n    name: '草稿',\r\n    color: '#BDC3C7',\r\n    description: '活动尚未发布'\r\n  },\r\n  registration: {\r\n    name: '报名中',\r\n    color: '#3498DB',\r\n    description: '正在接受报名'\r\n  },\r\n  ongoing: {\r\n    name: '进行中',\r\n    color: '#2ECC71',\r\n    description: '活动正在进行'\r\n  },\r\n  completed: {\r\n    name: '已结束',\r\n    color: '#95A5A6',\r\n    description: '活动已经结束'\r\n  },\r\n  cancelled: {\r\n    name: '已取消',\r\n    color: '#E74C3C',\r\n    description: '活动已被取消'\r\n  }\r\n}\r\n\r\n// 报名状态配置\r\nexport const registrationStatus = {\r\n  pending: {\r\n    name: '待审核',\r\n    color: '#F39C12',\r\n    description: '等待管理员审核'\r\n  },\r\n  approved: {\r\n    name: '已通过',\r\n    color: '#27AE60',\r\n    description: '报名已通过'\r\n  },\r\n  rejected: {\r\n    name: '已拒绝',\r\n    color: '#E74C3C',\r\n    description: '报名被拒绝'\r\n  },\r\n  cancelled: {\r\n    name: '已取消',\r\n    color: '#95A5A6',\r\n    description: '用户取消报名'\r\n  },\r\n  waitlist: {\r\n    name: '等待列表',\r\n    color: '#8E44AD',\r\n    description: '在等待列表中'\r\n  }\r\n}\r\n\r\n// 活动可见性配置\r\nexport const activityVisibility = {\r\n  public: {\r\n    name: '公开活动',\r\n    icon: '🌍',\r\n    description: '所有用户可见'\r\n  },\r\n  team: {\r\n    name: '团队活动',\r\n    icon: '👥',\r\n    description: '仅团队成员可见'\r\n  }\r\n}\r\n\r\n// 工具函数\r\nexport const activityUtils = {\r\n  // 获取活动类型信息\r\n  getTypeInfo(type) {\r\n    return activityTypes[type] || { name: '未知类型', icon: '❓', color: '#BDC3C7' }\r\n  },\r\n\r\n  // 获取活动状态信息\r\n  getStatusInfo(status) {\r\n    return activityStatus[status] || { name: '未知状态', color: '#BDC3C7' }\r\n  },\r\n\r\n  // 获取报名状态信息\r\n  getRegistrationStatusInfo(status) {\r\n    return registrationStatus[status] || { name: '未知状态', color: '#BDC3C7' }\r\n  },\r\n\r\n  // 获取可见性信息\r\n  getVisibilityInfo(visibility) {\r\n    return activityVisibility[visibility] || { name: '未知', icon: '❓' }\r\n  },\r\n\r\n  // 格式化活动时间\r\n  formatActivityTime(startTime, endTime) {\r\n    const start = new Date(startTime)\r\n    const end = new Date(endTime)\r\n    const now = new Date()\r\n\r\n    const formatDate = (date) => {\r\n      const year = date.getFullYear()\r\n      const month = String(date.getMonth() + 1).padStart(2, '0')\r\n      const day = String(date.getDate()).padStart(2, '0')\r\n      const hour = String(date.getHours()).padStart(2, '0')\r\n      const minute = String(date.getMinutes()).padStart(2, '0')\r\n      \r\n      return `${year}-${month}-${day} ${hour}:${minute}`\r\n    }\r\n\r\n    const isSameDay = start.toDateString() === end.toDateString()\r\n    \r\n    if (isSameDay) {\r\n      return `${formatDate(start)} - ${end.getHours().toString().padStart(2, '0')}:${end.getMinutes().toString().padStart(2, '0')}`\r\n    } else {\r\n      return `${formatDate(start)} - ${formatDate(end)}`\r\n    }\r\n  },\r\n\r\n  // 检查活动是否可以报名\r\n  canRegister(activity) {\r\n    const now = new Date()\r\n    const registrationDeadline = activity.registration_deadline ? new Date(activity.registration_deadline) : null\r\n    \r\n    // 检查活动状态\r\n    if (activity.status !== 'registration') {\r\n      return { canRegister: false, reason: '活动未开放报名' }\r\n    }\r\n\r\n    // 检查报名截止时间\r\n    if (registrationDeadline && now > registrationDeadline) {\r\n      return { canRegister: false, reason: '报名已截止' }\r\n    }\r\n\r\n    // 检查人数限制\r\n    if (activity.max_participants > 0 && activity.registration_count >= activity.max_participants) {\r\n      return { canRegister: false, reason: '报名人数已满' }\r\n    }\r\n\r\n    // 检查用户是否已报名\r\n    if (activity.user_registered) {\r\n      return { canRegister: false, reason: '已经报名' }\r\n    }\r\n\r\n    return { canRegister: true }\r\n  },\r\n\r\n  // 获取活动进度百分比\r\n  getProgressPercentage(activity) {\r\n    if (!activity.max_participants || activity.max_participants <= 0) {\r\n      return 0 // 无限制时不显示进度\r\n    }\r\n\r\n    const percentage = (activity.registration_count / activity.max_participants) * 100\r\n    // 使用 Math.floor 确保只返回整数部分\r\n    return Math.floor(Math.min(percentage, 100))\r\n  }\r\n}\r\n"],"names":["get","post","put","del"],"mappings":"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"}