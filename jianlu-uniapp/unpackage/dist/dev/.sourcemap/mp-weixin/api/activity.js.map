{"version":3,"file":"activity.js","sources":["api/activity.js"],"sourcesContent":["import { get, post, put, del } from '../utils/request.js'\n\n// 活动API接口（使用小程序专用API）\nexport const activityApi = {\n  // 获取活动列表\n  getList(params = {}) {\n    return get('/miniapp/activities', params)\n  },\n\n  // 获取活动详情\n  getDetail(id) {\n    return get(`/miniapp/activities/${id}`)\n  },\n\n  // 创建活动\n  create(data) {\n    return post('/miniapp/activities', data)\n  },\n\n  // 更新活动\n  update(id, data) {\n    return put(`/miniapp/activities/${id}`, data)\n  },\n\n  // 删除活动\n  delete(id) {\n    return del(`/miniapp/activities/${id}`)\n  },\n\n  // 报名活动\n  register(id, data) {\n    return post(`/miniapp/activities/${id}/register`, data)\n  },\n\n  // 取消报名\n  cancelRegistration(id) {\n    return del(`/miniapp/activities/${id}/register`)\n  },\n\n  // 获取我的报名列表\n  getMyRegistrations(params = {}) {\n    return get('/miniapp/my-registrations', params)\n  },\n\n  // 获取活动报名列表（管理员）\n  getRegistrations(id, params = {}) {\n    return get(`/miniapp/activities/${id}/registrations`, params)\n  },\n\n  // 审核报名（管理员）\n  approveRegistration(registrationId, approved = true) {\n    return post(`/miniapp/registrations/${registrationId}/approve`, { approved })\n  },\n\n  // 批量审核报名（管理员）\n  batchApproveRegistrations(registrationIds, approved = true) {\n    return post('/miniapp/registrations/batch-approve', { \n      registration_ids: registrationIds, \n      approved \n    })\n  }\n}\n\n// 活动类型配置\nexport const activityTypes = {\n  travel: {\n    name: '旅游活动',\n    icon: '🏖️',\n    color: '#FF6B6B',\n    description: '团建旅行、户外探险等'\n  },\n  meeting: {\n    name: '会议活动', \n    icon: '💼',\n    color: '#4ECDC4',\n    description: '技术分享、工作会议等'\n  },\n  social: {\n    name: '社交活动',\n    icon: '🎉',\n    color: '#45B7D1',\n    description: '聚餐、娱乐等'\n  },\n  learning: {\n    name: '学习活动',\n    icon: '📚',\n    color: '#96CEB4',\n    description: '培训、讲座等'\n  },\n  sports: {\n    name: '运动活动',\n    icon: '⚽',\n    color: '#FFEAA7',\n    description: '健身、比赛等'\n  }\n}\n\n// 活动状态配置\nexport const activityStatus = {\n  draft: {\n    name: '草稿',\n    color: '#BDC3C7',\n    description: '活动尚未发布'\n  },\n  registration: {\n    name: '报名中',\n    color: '#3498DB',\n    description: '正在接受报名'\n  },\n  ongoing: {\n    name: '进行中',\n    color: '#2ECC71',\n    description: '活动正在进行'\n  },\n  completed: {\n    name: '已结束',\n    color: '#95A5A6',\n    description: '活动已经结束'\n  },\n  cancelled: {\n    name: '已取消',\n    color: '#E74C3C',\n    description: '活动已被取消'\n  }\n}\n\n// 报名状态配置\nexport const registrationStatus = {\n  pending: {\n    name: '待审核',\n    color: '#F39C12',\n    description: '等待管理员审核'\n  },\n  approved: {\n    name: '已通过',\n    color: '#27AE60',\n    description: '报名已通过'\n  },\n  rejected: {\n    name: '已拒绝',\n    color: '#E74C3C',\n    description: '报名被拒绝'\n  },\n  cancelled: {\n    name: '已取消',\n    color: '#95A5A6',\n    description: '用户取消报名'\n  },\n  waitlist: {\n    name: '等待列表',\n    color: '#8E44AD',\n    description: '在等待列表中'\n  }\n}\n\n// 活动可见性配置\nexport const activityVisibility = {\n  public: {\n    name: '公开活动',\n    icon: '🌍',\n    description: '所有用户可见'\n  },\n  team: {\n    name: '团队活动',\n    icon: '👥',\n    description: '仅团队成员可见'\n  }\n}\n\n// 工具函数\nexport const activityUtils = {\n  // 获取活动类型信息\n  getTypeInfo(type) {\n    return activityTypes[type] || { name: '未知类型', icon: '❓', color: '#BDC3C7' }\n  },\n\n  // 获取活动状态信息\n  getStatusInfo(status) {\n    return activityStatus[status] || { name: '未知状态', color: '#BDC3C7' }\n  },\n\n  // 获取报名状态信息\n  getRegistrationStatusInfo(status) {\n    return registrationStatus[status] || { name: '未知状态', color: '#BDC3C7' }\n  },\n\n  // 获取可见性信息\n  getVisibilityInfo(visibility) {\n    return activityVisibility[visibility] || { name: '未知', icon: '❓' }\n  },\n\n  // 格式化活动时间\n  formatActivityTime(startTime, endTime) {\n    const start = new Date(startTime)\n    const end = new Date(endTime)\n    const now = new Date()\n\n    const formatDate = (date) => {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      const hour = String(date.getHours()).padStart(2, '0')\n      const minute = String(date.getMinutes()).padStart(2, '0')\n      \n      return `${year}-${month}-${day} ${hour}:${minute}`\n    }\n\n    const isSameDay = start.toDateString() === end.toDateString()\n    \n    if (isSameDay) {\n      return `${formatDate(start)} - ${end.getHours().toString().padStart(2, '0')}:${end.getMinutes().toString().padStart(2, '0')}`\n    } else {\n      return `${formatDate(start)} - ${formatDate(end)}`\n    }\n  },\n\n  // 检查活动是否可以报名\n  canRegister(activity) {\n    const now = new Date()\n    const registrationDeadline = activity.registration_deadline ? new Date(activity.registration_deadline) : null\n    \n    // 检查活动状态\n    if (activity.status !== 'registration') {\n      return { canRegister: false, reason: '活动未开放报名' }\n    }\n\n    // 检查报名截止时间\n    if (registrationDeadline && now > registrationDeadline) {\n      return { canRegister: false, reason: '报名已截止' }\n    }\n\n    // 检查人数限制\n    if (activity.max_participants > 0 && activity.registration_count >= activity.max_participants) {\n      return { canRegister: false, reason: '报名人数已满' }\n    }\n\n    // 检查用户是否已报名\n    if (activity.user_registered) {\n      return { canRegister: false, reason: '已经报名' }\n    }\n\n    return { canRegister: true }\n  },\n\n  // 获取活动进度百分比\n  getProgressPercentage(activity) {\n    if (!activity.max_participants || activity.max_participants <= 0) {\n      return 0 // 无限制时不显示进度\n    }\n\n    const percentage = (activity.registration_count / activity.max_participants) * 100\n    // 使用 Math.floor 确保只返回整数部分\n    return Math.floor(Math.min(percentage, 100))\n  }\n}\n"],"names":["get","post","put","del"],"mappings":"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"}