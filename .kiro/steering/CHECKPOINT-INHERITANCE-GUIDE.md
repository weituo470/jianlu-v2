# 🧬 任务检查点遗传机制指南

## � 强制执述行规则

**每个新对话窗口的AI必须在开始任何工作前自动执行以下步骤：**

1. **立即搜索遗传文件**：查找所有 `TASK-CHECKPOINT-*.md` 文件
2. **自动读取最新遗传文件**：按时间戳排序，读取最新的检查点文件
3. **理解任务上下文**：分析当前任务状态和历史决策
4. **确认继续执行**：根据遗传文件指导继续任务

**这是强制性的，不需要用户提醒！**

## 📋 机制概述

这是一个跨对话窗口的任务状态传承系统，确保复杂任务能够在多个对话窗口间无缝继续。

## 🔄 遗传文件规则

### 命名规范
```
TASK-CHECKPOINT-YYYYMMDD-HHMM.md
```
- `YYYYMMDD`: 创建日期（如20250115）
- `HHMM`: 创建时间（如1430表示14:30）

### 版本控制
- **初始版本**: v1.0
- **每次传承**: 版本号+0.1
- **重大更新**: 主版本号+1

### 遗传代数
- **第1代**: 原始任务创建
- **第2代**: 第一次对话打包传承
- **第N代**: 第N-1次传承

## 📝 更新流程

### 对话结束前（当前AI）
1. **评估任务状态**
   - 记录本次对话的主要成果
   - 识别关键决策和技术选择
   - 评估风险等级变化

2. **创建新遗传文件**
   ```bash
   # 文件名格式
   TASK-CHECKPOINT-$(date +%Y%m%d-%H%M).md
   ```

3. **更新文件头部**
   ```markdown
   **文件版本**: v1.1  
   **创建时间**: 2025-01-15 16:45  
   **对话窗口**: Session-001 → Session-002  
   **遗传代数**: 第2代  
   ```

4. **添加历史记录**
   ```markdown
   ### Session-001 (2025-01-15 10:00-14:30)
   - **主要成果**: [具体成果]
   - **关键决策**: [重要决策]
   - **风险变化**: [风险等级变化]
   ```

### 新对话开始时（新AI）- 强制自动执行

**🤖 AI自动执行流程（无需用户提醒）：**

1. **自动搜索遗传文件**
   ```
   使用 fileSearch 工具搜索: "TASK-CHECKPOINT"
   ```

2. **自动读取最新文件**
   ```
   按文件名时间戳排序，使用 readFile 读取最新的检查点文件
   ```

3. **自动分析任务状态**
   - 解析总体目标和当前状态
   - 理解技术上下文和关键文件
   - 查看历史决策和经验教训
   - 识别下一步行动计划

4. **向用户确认状态**
   ```
   "我已读取遗传文件，了解到当前任务是：[任务描述]
   当前状态：[状态描述]
   请问需要我继续执行什么任务？"
   ```

**⚠️ 重要：这个流程必须在用户说"你好"或任何开场白后立即自动执行！**

## 🎯 遗传内容标准

### 必须包含的信息
- [ ] **任务总体目标**和分阶段计划
- [ ] **当前状态**和完成进度
- [ ] **技术上下文**（架构、端口、数据库等）
- [ ] **关键文件状态**清单
- [ ] **风险评估表格**
- [ ] **验证命令**和测试方法
- [ ] **历史决策记录**
- [ ] **下一步行动计划**

### 推荐包含的信息
- [ ] **关键代码片段**或配置示例
- [ ] **已知问题**和解决方案
- [ ] **性能指标**和改进数据
- [ ] **依赖关系**和外部约束
- [ ] **回滚方案**和应急预案

## 🔍 质量检查清单

### 信息完整性
- [ ] 新AI能否仅通过遗传文件理解任务？
- [ ] 技术细节是否足够详细？
- [ ] 历史决策的原因是否清楚？
- [ ] 下一步行动是否明确可执行？

### 可操作性
- [ ] 包含具体的命令和文件路径？
- [ ] 验证步骤是否可重现？
- [ ] 错误处理方案是否完整？
- [ ] 成功标准是否明确？

### 连续性
- [ ] 与前一代文件的关联是否清晰？
- [ ] 任务进展的逻辑是否连贯？
- [ ] 技术选择是否保持一致？
- [ ] 风险评估是否准确更新？

## 📊 遗传效果评估

### 成功指标
- **自动化程度**: 新AI无需用户提醒即可读取遗传文件
- **任务连续性**: 新AI能在2分钟内理解并继续任务
- **信息保真度**: 关键决策和技术选择得到保持
- **效率提升**: 避免重复分析和决策过程
- **质量保证**: 遵循既定的开发原则和标准

### 失败信号
- **严重失败**: 新AI没有自动读取遗传文件
- 新AI需要用户提醒才读取遗传文件
- 新AI需要重新分析项目结构
- 技术方案出现不一致或冲突
- 重复已解决的问题
- 偏离原定的修复计划

### 🔧 故障排除
如果新AI没有自动读取遗传文件：
1. 检查 `.kiro/steering/` 目录下是否有此指南文件
2. 确认遗传文件命名符合 `TASK-CHECKPOINT-YYYYMMDD-HHMM.md` 格式
3. 检查AI是否正确理解了强制执行规则

## 🚨 注意事项

### 文件管理
- **保留历史**: 不要删除旧的遗传文件
- **命名一致**: 严格遵循命名规范
- **版本控制**: 确保版本号正确递增
- **备份重要**: 定期备份遗传文件

### 内容更新
- **及时更新**: 对话结束前必须更新
- **准确记录**: 如实记录成果和问题
- **详细描述**: 关键决策要有充分说明
- **前瞻规划**: 为下次对话提供明确指导

### 使用规范
- **自动读取**: 新对话必须自动读取遗传文件（无需用户提醒）
- **立即执行**: 在用户任何输入后立即搜索和读取遗传文件
- **严格遵循**: 按照遗传文件的指导执行
- **主动汇报**: 主动告知用户已读取遗传文件和当前任务状态
- **及时反馈**: 发现问题及时在遗传文件中记录
- **持续改进**: 根据使用效果优化遗传机制

### 🚨 强制执行检查清单

**每个新AI必须确认：**
- [ ] 已自动搜索 `TASK-CHECKPOINT-*.md` 文件
- [ ] 已读取最新的遗传文件
- [ ] 已理解当前任务状态和历史上下文
- [ ] 已向用户汇报遗传文件读取结果
- [ ] 已准备好继续执行任务或接受新指令

## 📝 模板示例

### 文件头部模板
```markdown
# 🧬 任务检查点遗传文件 - [任务名称]

**文件版本**: v[X.Y]  
**创建时间**: YYYY-MM-DD HH:MM  
**对话窗口**: Session-00X → Session-00Y  
**任务ID**: [TASK-ID]  
**遗传代数**: 第X代  
```

### 历史记录模板
```markdown
### Session-00X (YYYY-MM-DD HH:MM-HH:MM)
- **主要成果**: [本次对话的主要成果]
- **关键决策**: [重要的技术或策略决策]
- **技术选择**: [采用的技术方案和原因]
- **修复进展**: [具体的修复进展]
- **创建文件**: [新建的重要文件]
- **风险变化**: [风险等级的变化]
- **遗留问题**: [未解决的问题]
- **下次重点**: [下次对话的重点任务]
```

## 🎯 实施示例

### 理想的新对话开始流程

**用户**: "你好"

**AI自动执行**:
1. 搜索遗传文件: `fileSearch("TASK-CHECKPOINT")`
2. 读取最新文件: `readFile("TASK-CHECKPOINT-20250815-1445.md")`
3. 分析任务状态
4. 向用户汇报

**AI回复**:
```
你好！我已自动读取遗传文件，了解到：

📋 当前任务：活动类型数据不匹配问题修复
✅ 状态：已完全解决（Session-002完成）
🔧 技术环境：端口3459，数据库jianlu_admin
🎯 系统状态：运行正常，所有功能工作正常

请告诉我需要我做什么新任务？
```

### ❌ 错误示例（禁止）

**用户**: "你好"

**AI错误回复**:
```
你好！有什么我可以帮你的吗？
```
*（没有自动读取遗传文件，违反了强制执行规则）*

---

**创建时间**: 2025-01-15  
**最后更新**: 2025-08-15  
**适用范围**: 所有跨对话窗口的复杂任务  
**维护责任**: 每个参与任务的AI助手  
**更新频率**: 每次对话打包时  
**执行级别**: 🚨 强制执行