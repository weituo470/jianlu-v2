# 任务完结概率机制

## 🎯 机制目标
建立自我评估和校准系统，提高任务完成的准确性和用户满意度。

## 📋 评估流程

### 评估时机和内容：
1. **评估时机**: 在能够验证任务结果的合适时机进行评估
2. **特殊情况**: 需要询问用户、发现新线索、任务中断时可暂不评估
3. **评估内容**:
   - **任务完结概率** (0-100%)
   - **评估依据** (具体原因)
   - **风险因素** (可能导致失败的因素)
   - **检验标准** (具体的、可验证的完成标准)
   - **任务总耗时** (当前单次会话的累计时间)

### 评估公式：
```
基础概率 = 历史成功率 (当前33%)
调整因素：
+ 任务简单度 (+0-30%)
+ 有成功先例 (+20%)
+ 用户提示明确 (+15%)
+ 技术熟悉度 (+10%)
- 任务复杂度 (-10-40%)
- 需要创新方案 (-20%)
- 时间压力 (-10%)

最终概率 = max(5%, min(95%, 基础概率 + 调整因素))
```

## 📊 历史数据分析

### 当前状态 (2025-08-08)
- **总任务数**: 3
- **成功任务**: 1 (任务复盘机制优化)
- **失败任务**: 2 (数据迁移、下拉框修复)
- **历史成功率**: 33%
- **平均得分**: 3.97分

### 失败模式分析
1. **过度复杂化** (2/2失败任务)
   - 为简单问题设计复杂解决方案
   - 忽视现有成功模式
   
2. **忽视用户反馈** (1/2失败任务)
   - 用户明确提示被忽略
   - 坚持错误的技术方向
   
3. **违反核心原则** (2/2失败任务)
   - 不遵循先例优先思维
   - 违反奥卡姆剃刀原则

### 成功模式分析
1. **任务复盘机制优化** (8.0分)
   - 任务相对简单
   - 有明确的改进方向
   - 用户需求清晰

## 🎯 概率校准规则

### 高概率任务 (70%+)
- 有成功先例可直接复制
- 任务简单明确
- 用户提示具体
- 技术方案成熟

### 中概率任务 (40-70%)
- 任务复杂度中等
- 需要一定创新
- 技术方案需要验证

### 低概率任务 (40%-)
- 任务复杂度高
- 需要大量创新
- 技术不熟悉
- 用户需求不明确

## 📈 自我修正机制

### 每次任务完成后：
1. **记录实际结果** (成功/失败)
2. **计算概率偏差** (预测 - 实际)
3. **分析偏差原因**
4. **调整评估模型**

### 偏差分析
- **高估** (预测>实际): 过于自信，忽视风险
- **低估** (预测<实际): 过于保守，低估能力
- **目标偏差**: ±20%以内

## ⏱️ 任务总耗时计算规则

### 计时范围
- **包含**: 当前单次会话中所有与任务相关的操作时间
- **包含**: 分析问题、编写代码、测试验证、文档更新等
- **不包含**: 等待用户回复的时间
- **不包含**: 系统处理或网络延迟时间

### 计时方法
- 累加所有"已耗时: X分钟"的记录
- 四舍五入到整数分钟
- 最小计时单位: 1分钟

## 🎯 检验标准制定原则

### 好的检验标准特征：
1. **具体可操作** - 明确说明用户需要执行的具体操作
2. **结果可验证** - 有明确的成功/失败判断标准
3. **用户视角** - 从用户使用角度描述，而非技术实现角度
4. **完整覆盖** - 涵盖任务的核心功能点

### 检验标准示例：
- ✅ "用户能够在活动类型管理页面成功删除一个已有活动类型"
- ✅ "管理员可以在团队管理页面创建新团队并看到成功提示"
- ❌ "API接口返回正确的JSON数据" (技术视角，用户无法直接验证)
- ❌ "代码没有语法错误" (技术视角，不是用户关心的结果)

## 🔄 持续改进

### 每5个任务后：
1. 重新计算历史成功率
2. 更新评估公式参数
3. 识别新的失败/成功模式
4. 调整概率校准规则
5. 分析检验标准的有效性

### 长期目标
- **任务成功率**: 70%+
- **概率预测准确度**: ±15%以内
- **平均任务得分**: 7分+
- **检验标准准确率**: 90%+
- **平均任务耗时**: 控制在合理范围内

## 📝 使用模板

### 任务完结概率评估（在合适时机）
```
---

## 🎯 任务完结概率评估

**任务完结概率**: X%

**评估依据**:
- 基础概率: 33%
- [调整因素]: +/-X%
- ...
= 最终概率: X%

**风险因素**: [具体风险描述]

**检验标准**: [具体的、可验证的完成标准]

**任务总耗时**: X分钟 (当前会话累计)

---

## 📊 任务完结记录

**预测概率**: X%
**实际结果**: 成功/失败
**概率偏差**: ±X%
**偏差原因**: [分析原因]
**改进建议**: [下次如何改进]
```

### 暂不评估的情况示例
- 需要用户确认方案选择时
- 发现新的技术线索需要深入调查时
- 任务被其他紧急问题中断时
- 等待外部依赖（如服务重启）时

### 不纳入概率统计的衍生任务
- **代码格式错误修复** - 纯技术性的格式问题
- **语法错误修正** - IDE提示的语法问题
- **导入路径修复** - 文件引用路径问题
- **变量名拼写错误** - 简单的拼写修正
- **缩进和空格调整** - 代码美化相关
- **临时文件清理** - 测试文件的删除

这些衍生任务通常：
- 不是用户的主要需求
- 技术难度较低
- 修复过程相对机械化
- 不影响核心功能实现

---

**建立时间**: 2025-08-08  
**当前版本**: v1.0  
**下次更新**: 完成5个任务后