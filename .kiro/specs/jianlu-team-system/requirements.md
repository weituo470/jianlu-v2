# 简庐团队系统需求文档

## 介绍

基于简庐开发文档，实现完整的机构管理系统，包含多层级机构结构、复杂角色权限体系、资金管理、虚拟币系统等核心功能。该系统将替换现有的简单团队管理，提供企业级的机构协作平台。

## 需求

### 需求 1：用户身份体系

**用户故事：** 作为平台管理员，我希望建立完整的用户身份分类体系，以便支持不同类型用户的差异化功能需求。

#### 验收标准
1. WHEN 用户注册时 THEN 系统应生成17位唯一ID（注册时间年月日时+7位顺序编码）
2. WHEN 普通用户通过手机验证注册时 THEN 系统应标识为P类型会员
3. WHEN 普通会员为家庭成员注册亲情账号时 THEN 系统应标识为Q类型会员
4. WHEN 普通会员认证成为商户时 THEN 系统应将标识从P变更为V
5. WHEN 亲情会员获得手机号时 THEN 系统应支持升级为普通会员（Q→P）
6. WHEN 用户设置昵称时 THEN 系统应限制在20字节内且允许重名

### 需求 2：多层级机构管理

**用户故事：** 作为机构创建者，我希望建立多层级的机构体系，以便管理复杂的组织结构和成员关系。

#### 验收标准
1. WHEN P/V会员创建机构时 THEN 系统应支持设置机构类型（国家认证/民间团体）
2. WHEN 创建机构时 THEN 系统应支持选择1-3个分类标签（商会、协会、俱乐部等28种）
3. WHEN 机构创建后 THEN 系统应支持创建二级机构
4. WHEN 一级或二级机构存在时 THEN 系统应支持在其下创建多个分组
5. WHEN 用户加入多个机构/分组时 THEN 系统应以ID为准避免重复统计
6. WHEN Q类型会员申请加入时 THEN 系统应通过对应P会员进行操作

### 需求 3：机构成员管理

**用户故事：** 作为机构管理员，我希望灵活管理成员的加入方式和审核流程，以便控制机构成员质量。

#### 验收标准
1. WHEN 管理员设置加入方式时 THEN 系统应支持三种方式：邀请加入、扫码加入、在线申请
2. WHEN 用户通过扫码加入时 THEN 系统应生成短期有效二维码
3. WHEN 用户申请加入时 THEN 系统应要求先注册为平台会员
4. WHEN 成员申请加入时 THEN 系统应要求机构授权人员审核通过
5. WHEN 管理员关闭某种加入方式时 THEN 系统应对应隐藏相关入口

### 需求 4：角色权限体系

**用户故事：** 作为机构创建者，我希望建立灵活的角色权限体系，以便精确控制不同成员的操作权限。

#### 验收标准
1. WHEN 创建机构时 THEN 系统应提供预设角色清单（会长、副会长、秘书长等）
2. WHEN 分配角色时 THEN 系统应支持自定义角色名称
3. WHEN 设置权限时 THEN 系统应提供12种机构管理权限选项
4. WHEN 创建人授权管理员时 THEN 被授权者应获得对应的操作权限
5. WHEN 有权限人员离职时 THEN 系统应支持权限取消和转移

### 需求 5：活动权限管理

**用户故事：** 作为活动创建者，我希望为活动参与者分配不同角色和权限，以便有序管理活动流程。

#### 验收标准
1. WHEN 创建活动时 THEN 系统应提供活动角色清单（创建人、导游、领队等15种）
2. WHEN 分配活动权限时 THEN 系统应提供10种活动权限选项
3. WHEN 机构授权人创建活动时 THEN 系统应支持选择以机构名义发起
4. WHEN 个人创建活动时 THEN 系统应仅支持个人名义发起
5. WHEN 活动创建人隐身时 THEN 系统应支持后台管理但不参与记账

### 需求 6：资金管理体系

**用户故事：** 作为平台用户，我希望有完善的资金管理功能，以便安全便捷地处理各种费用结算。

#### 验收标准
1. WHEN 设置诚信金时 THEN 系统应按5级规则管理退还（100%/80%/70%/80%分成/默认退还）
2. WHEN 进行AA费用结算时 THEN 系统应支持复杂的个性化参数计算（K/X/D参数）
3. WHEN 机构有资金账户时 THEN 系统应支持多人审核的提现流程
4. WHEN 成员赞助机构时 THEN 系统应发送感谢信息并记录
5. WHEN 线上支付时 THEN 系统应支持平台托管和原路退回

### 需求 7：虚拟币系统

**用户故事：** 作为平台运营者，我希望建立虚拟币激励体系，以便提高用户活跃度和平台粘性。

#### 验收标准
1. WHEN 新用户注册时 THEN 系统应赠送1000量子
2. WHEN 创建有效机构时 THEN 系统应奖励10量子（成员≥5人）
3. WHEN 发布活动时 THEN 系统应奖励10量子
4. WHEN 观看完整广告时 THEN 系统应奖励5量子
5. WHEN 上传记录时 THEN 系统应按规则消耗量子（图片1个/视频5个每分钟）

### 需求 8：数据字典管理

**用户故事：** 作为系统管理员，我希望建立完整的数据字典体系，以便标准化各类分类和选项。

#### 验收标准
1. WHEN 管理机构分类时 THEN 系统应提供28种标签选项
2. WHEN 管理活动角色时 THEN 系统应提供15种预设角色
3. WHEN 管理机构角色时 THEN 系统应根据机构类型提供对应角色清单
4. WHEN 管理费用分类时 THEN 系统应提供活动/个人/机构三套分类体系
5. WHEN 需要扩展字典时 THEN 系统应支持后台动态添加和编辑

### 需求 9：权限控制系统

**用户故事：** 作为系统架构师，我希望建立细粒度的权限控制系统，以便确保功能访问的安全性。

#### 验收标准
1. WHEN 用户访问功能时 THEN 系统应基于角色和权限进行访问控制
2. WHEN 权限不足时 THEN 系统应隐藏对应按钮或显示为灰色不可操作
3. WHEN 在手机端操作时 THEN 权限控制应与PC端保持一致
4. WHEN 权限变更时 THEN 系统应实时更新用户界面
5. WHEN 创建人操作时 THEN 系统应始终保证最高权限

### 需求 10：多端同步支持

**用户故事：** 作为平台用户，我希望在手机端和PC端都能完整使用系统功能，以便灵活选择操作方式。

#### 验收标准
1. WHEN 在手机端操作时 THEN 所有核心功能应完整可用
2. WHEN 在PC端操作时 THEN 应提供更适合管理的界面布局
3. WHEN 数据发生变更时 THEN 多端应实时同步更新
4. WHEN 权限控制时 THEN 多端应保持一致的访问控制
5. WHEN 进行复杂操作时 THEN PC端应提供更便捷的批量处理功能