<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404é”™è¯¯è¯Šæ–­å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .diagnostic-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .diagnostic-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .error-section {
            border-left-color: #dc3545;
        }
        .success-section {
            border-left-color: #28a745;
        }
        .resource-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa;
        }
        .resource-success {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .resource-error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .resource-loading {
            background: #e2e3e5;
            border-color: #ced4da;
        }
        .status-icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }
        .resource-info {
            flex: 1;
            margin: 0 15px;
        }
        .resource-path {
            font-family: monospace;
            font-size: 12px;
            color: #6c757d;
        }
        .btn-test {
            margin: 5px;
        }
        .error-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #495057;
        }
        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }
        .log-entry {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            border-left: 3px solid #007bff;
        }
        .log-error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .log-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .log-warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <h1 class="text-center mb-4">
            <i class="fas fa-search text-danger"></i>
            404é”™è¯¯è¯Šæ–­å·¥å…·
        </h1>

        <div class="diagnostic-section error-section">
            <h3><i class="fas fa-exclamation-triangle"></i> 404é”™è¯¯åˆ†æ</h3>
            <div class="error-message">
                <strong>404é”™è¯¯è¯´æ˜ï¼š</strong>
                <p>404 Not Found è¡¨ç¤ºæœåŠ¡å™¨æ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ï¼š</p>
                <ul>
                    <li>ğŸ“ èµ„æºæ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯</li>
                    <li>ğŸ”— HTMLä¸­çš„å¼•ç”¨è·¯å¾„ä¸å®é™…æ–‡ä»¶è·¯å¾„ä¸åŒ¹é…</li>
                    <li>ğŸš¦ æœåŠ¡å™¨è·¯ç”±é…ç½®é—®é¢˜</li>
                    <li>ğŸ“‚ æ–‡ä»¶è¢«ç§»åŠ¨æˆ–åˆ é™¤</li>
                    <li>âš¡ é™æ€æ–‡ä»¶ä¸­é—´ä»¶é…ç½®é”™è¯¯</li>
                </ul>
            </div>
        </div>

        <div class="diagnostic-section">
            <h3><i class="fas fa-list-check"></i> èµ„æºçŠ¶æ€æ£€æŸ¥</h3>
            <p>ç‚¹å‡»æŒ‰é’®æ£€æŸ¥æ´»åŠ¨è¯¦æƒ…é¡µé¢çš„æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼š</p>
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-primary" onclick="checkAllResources()">
                    <i class="fas fa-check-double me-2"></i>æ£€æŸ¥æ‰€æœ‰èµ„æº
                </button>
                <button class="btn btn-success" onclick="checkCSSResources()">
                    <i class="fas fa-css3 me-2"></i>æ£€æŸ¥CSSæ–‡ä»¶
                </button>
                <button class="btn btn-info" onclick="checkJSResources()">
                    <i class="fas fa-file-code me-2"></i>æ£€æŸ¥JSæ–‡ä»¶
                </button>
                <button class="btn btn-warning" onclick="checkExternalResources()">
                    <i class="fas fa-globe me-2"></i>æ£€æŸ¥å¤–éƒ¨èµ„æº
                </button>
            </div>
            <div id="resource-status"></div>
        </div>

        <div class="diagnostic-section">
            <h3><i class="fas fa-chart-line"></i> è¯Šæ–­ç»Ÿè®¡</h3>
            <div id="stats-container" class="stats-grid">
                <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="diagnostic-section">
            <h3><i class="fas fa-tools"></i> ä¿®å¤å»ºè®®</h3>
            <div class="accordion" id="fixAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#fixFileNotFound">
                            æ–‡ä»¶ä¸å­˜åœ¨ (404)
                        </button>
                    </h2>
                    <div id="fixFileNotFound" class="accordion-collapse collapse show" data-bs-parent="#fixAccordion">
                        <div class="accordion-body">
                            <h5>è§£å†³æ–¹æ¡ˆï¼š</h5>
                            <ol>
                                <li><strong>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</strong>ï¼šç¡®è®¤æ–‡ä»¶åœ¨æ­£ç¡®çš„ç›®å½•ä¸­</li>
                                <li><strong>æ£€æŸ¥æ–‡ä»¶åå¤§å°å†™</strong>ï¼šç¡®ä¿æ–‡ä»¶åå®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</li>
                                <li><strong>æ£€æŸ¥è·¯å¾„æ ¼å¼</strong>ï¼šä½¿ç”¨æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</li>
                            </ol>
                            <div class="code-block">
                                <!-- æ­£ç¡®çš„è·¯å¾„ç¤ºä¾‹ -->
                                &lt;link href="/css/main.css" rel="stylesheet"&gt;
                                &lt;script src="/js/config.js"&gt;&lt;/script&gt;
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fixServerConfig">
                            æœåŠ¡å™¨é…ç½®é—®é¢˜
                        </button>
                    </h2>
                    <div id="fixServerConfig" class="accordion-collapse collapse" data-bs-parent="#fixAccordion">
                        <div class="accordion-body">
                            <h5>æ£€æŸ¥Expressé™æ€æ–‡ä»¶é…ç½®ï¼š</h5>
                            <div class="code-block">
                                // ç¡®ä¿é™æ€æ–‡ä»¶ä¸­é—´ä»¶é…ç½®æ­£ç¡®
                                app.use(express.static(path.join(__dirname, '../../admin-frontend')));

                                // é™æ€æ–‡ä»¶åº”è¯¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­
                                // admin-frontend/
                                // â”œâ”€â”€ css/
                                // â”œâ”€â”€ js/
                                // â””â”€â”€ uploads/
                            </div>
                            <h5>é‡å¯æœåŠ¡å™¨</h5>
                            <p>ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯Node.jsæœåŠ¡å™¨ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</p>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fixCacheIssue">
                            ç¼“å­˜é—®é¢˜
                        </button>
                    </h2>
                    <div id="fixCacheIssue" class="accordion-collapse collapse" data-bs-parent="#fixAccordion">
                        <div class="accordion-body">
                            <h5>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š</h5>
                            <ul>
                                <li><strong>ç¡¬åˆ·æ–°</strong>ï¼šCtrl+F5 (Windows) æˆ– Cmd+Shift+R (Mac)</li>
                                <li><strong>æ¸…é™¤ç¼“å­˜</strong>ï¼šåœ¨å¼€å‘è€…å·¥å…·ä¸­ç¦ç”¨ç¼“å­˜</li>
                                <li><strong>éšç§æ¨¡å¼</strong>ï¼šä½¿ç”¨éšç§æ¨¡å¼æµ‹è¯•</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h3><i class="fas fa-list"></i> å®æ—¶æ—¥å¿—</h3>
            <button class="btn btn-outline-primary" onclick="clearLog()">
                <i class="fas fa-trash me-2"></i>æ¸…é™¤æ—¥å¿—
            </button>
            <div id="log-container" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                <!-- æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script>
        // æ´»åŠ¨è¯¦æƒ…é¡µé¢å¼•ç”¨çš„èµ„æºåˆ—è¡¨
        const resources = {
            css: [
                {
                    name: 'Bootstrap CSS',
                    url: 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css',
                    description: 'Bootstrapæ¡†æ¶æ ·å¼è¡¨',
                    external: true
                },
                {
                    name: 'Font Awesome CSS',
                    url: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                    description: 'Font Awesomeå›¾æ ‡åº“',
                    external: true
                },
                {
                    name: 'Main CSS',
                    url: '/css/main.css',
                    description: 'ä¸»è¦æ ·å¼è¡¨æ–‡ä»¶',
                    external: false
                }
            ],
            js: [
                {
                    name: 'Bootstrap JS',
                    url: 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js',
                    description: 'Bootstrap JavaScriptåº“',
                    external: true
                },
                {
                    name: 'Config JS',
                    url: '/js/config.js',
                    description: 'é…ç½®æ–‡ä»¶',
                    external: false
                },
                {
                    name: 'Utils JS',
                    url: '/js/utils.js',
                    description: 'å·¥å…·å‡½æ•°åº“',
                    external: false
                },
                {
                    name: 'Auth JS',
                    url: '/js/auth.js',
                    description: 'è®¤è¯ç›¸å…³åŠŸèƒ½',
                    external: false
                },
                {
                    name: 'API JS',
                    url: '/js/api.js',
                    description: 'APIè°ƒç”¨å°è£…',
                    external: false
                },
                {
                    name: 'Router JS',
                    url: '/js/router.js',
                    description: 'è·¯ç”±ç®¡ç†',
                    external: false
                },
                {
                    name: 'Activity Detail Page JS',
                    url: '/js/activity-detail-page.js',
                    description: 'æ´»åŠ¨è¯¦æƒ…é¡µé¢é€»è¾‘',
                    external: false
                }
            ]
        };

        let stats = {
            total: 0,
            success: 0,
            error: 0,
            loading: 0
        };

        // æ£€æŸ¥å•ä¸ªèµ„æº
        async function checkResource(resource) {
            const element = document.getElementById(`resource-${resource.url.replace(/[^a-zA-Z0-9]/g, '')}`);
            if (element) {
                element.className = 'resource-item resource-loading';
                element.innerHTML = `
                    <div class="status-icon">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <div class="resource-info">
                        <strong>${resource.name}</strong><br>
                        <small class="text-muted">${resource.description}</small>
                        <div class="resource-path">${resource.url}</div>
                    </div>
                    <div class="status-text">
                        æ£€æŸ¥ä¸­...
                    </div>
                `;
            }

            stats.loading++;
            updateStats();

            try {
                const response = await fetch(resource.url, {
                    method: 'HEAD',
                    mode: resource.external ? 'cors' : 'no-cors'
                });

                if (element) {
                    element.className = response.ok ? 'resource-item resource-success' : 'resource-item resource-error';
                    element.innerHTML = `
                        <div class="status-icon">
                            <i class="fas fa-${response.ok ? 'check-circle text-success' : 'times-circle text-danger'}"></i>
                        </div>
                        <div class="resource-info">
                            <strong>${resource.name}</strong><br>
                            <small class="text-muted">${resource.description}</small>
                            <div class="resource-path">${resource.url}</div>
                        </div>
                        <div class="status-text">
                            ${response.ok ?
                                `âœ… HTTP ${response.status}` :
                                `âŒ HTTP ${response.status} (404 Not Found)`
                            }
                        </div>
                    `;
                }

                if (response.ok) {
                    stats.success++;
                    addLog(`âœ… ${resource.name} åŠ è½½æˆåŠŸ (${resource.url})`, 'success');
                } else {
                    stats.error++;
                    addLog(`âŒ ${resource.name} åŠ è½½å¤±è´¥: HTTP ${response.status} (${resource.url})`, 'error');

                    if (response.status === 404) {
                        add404Suggestions(resource);
                    }
                }
            } catch (error) {
                if (element) {
                    element.className = 'resource-item resource-error';
                    element.innerHTML = `
                        <div class="status-icon">
                            <i class="fas fa-exclamation-triangle text-danger"></i>
                        </div>
                        <div class="resource-info">
                            <strong>${resource.name}</strong><br>
                            <small class="text-muted">${resource.description}</small>
                            <div class="resource-path">${resource.url}</div>
                        </div>
                        <div class="status-text">
                            âŒ è¯·æ±‚å¤±è´¥: ${error.message}
                        </div>
                    `;
                }
                stats.error++;
                addLog(`âŒ ${resource.name} è¯·æ±‚å¼‚å¸¸: ${error.message} (${resource.url})`, 'error');
            }

            stats.loading--;
            stats.total++;
            updateStats();
        }

        // æ·»åŠ 404é”™è¯¯å»ºè®®
        function add404Suggestions(resource) {
            const suggestions = document.createElement('div');
            suggestions.className = 'alert alert-warning alert-dismissible fade show mt-2';
            suggestions.innerHTML = `
                <h6><i class="fas fa-lightbulb"></i> ${resource.name} 404é”™è¯¯ä¿®å¤å»ºè®®ï¼š</h6>
                <ol>
                    <li>ç¡®è®¤æ–‡ä»¶ <code>${resource.url}</code> æ˜¯å¦å­˜åœ¨</li>
                    <li>æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®</li>
                    <li>ç¡®è®¤æ–‡ä»¶åå¤§å°å†™æ˜¯å¦åŒ¹é…</li>
                    <li>æ£€æŸ¥æœåŠ¡å™¨é™æ€æ–‡ä»¶é…ç½®</li>
                </ol>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            const container = document.getElementById('resource-status');
            if (container) {
                container.appendChild(suggestions);
            }
        }

        // æ£€æŸ¥æ‰€æœ‰èµ„æº
        async function checkAllResources() {
            clearLog();
            addLog('ğŸš€ å¼€å§‹æ£€æŸ¥æ‰€æœ‰èµ„æº...', 'info');

            const allResources = [...resources.css, ...resources.js];

            // æ¸…ç©ºçŠ¶æ€æ˜¾ç¤º
            document.getElementById('resource-status').innerHTML = '';
            allResources.forEach(resource => {
                const element = document.createElement('div');
                element.id = `resource-${resource.url.replace(/[^a-zA-Z0-9]/g, '')}`;
                document.getElementById('resource-status').appendChild(element);
            });

            // å¹¶è¡Œæ£€æŸ¥æ‰€æœ‰èµ„æº
            await Promise.all(allResources.map(resource => checkResource(resource)));

            addLog(`âœ… èµ„æºæ£€æŸ¥å®Œæˆ: æˆåŠŸ ${stats.success}/${stats.total} ä¸ª`, 'success');
        }

        // æ£€æŸ¥CSSèµ„æº
        async function checkCSSResources() {
            clearLog();
            addLog('ğŸ¨ å¼€å§‹æ£€æŸ¥CSSèµ„æº...', 'info');

            document.getElementById('resource-status').innerHTML = '';
            resources.css.forEach(resource => {
                const element = document.createElement('div');
                element.id = `resource-${resource.url.replace(/[^a-zA-Z0-9]/g, '')}`;
                document.getElementById('resource-status').appendChild(element);
            });

            await Promise.all(resources.css.map(resource => checkResource(resource)));
        }

        // æ£€æŸ¥JSèµ„æº
        async function checkJSResources() {
            clearLog();
            addLog('ğŸ“œ å¼€å§‹æ£€æŸ¥JavaScriptèµ„æº...', 'info');

            document.getElementById('resource-status').innerHTML = '';
            resources.js.forEach(resource => {
                const element = document.createElement('div');
                element.id = `resource-${resource.url.replace(/[^a-zA-Z0-9]/g, '')}`;
                document.getElementById('resource-status').appendChild(element);
            });

            await Promise.all(resources.js.map(resource => checkResource(resource)));
        }

        // æ£€æŸ¥å¤–éƒ¨èµ„æº
        async function checkExternalResources() {
            clearLog();
            addLog('ğŸŒ å¼€å§‹æ£€æŸ¥å¤–éƒ¨èµ„æº...', 'info');

            const externalResources = [...resources.css, ...resources.js].filter(r => r.external);

            document.getElementById('resource-status').innerHTML = '';
            externalResources.forEach(resource => {
                const element = document.createElement('div');
                element.id = `resource-${resource.url.replace(/[^a-zA-Z0-9]/g, '')}`;
                document.getElementById('resource-status').appendChild(element);
            });

            await Promise.all(externalResources.map(resource => checkResource(resource)));
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const container = document.getElementById('stats-container');
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.total}</div>
                    <div class="stat-label">æ€»èµ„æºæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value text-success">${stats.success}</div>
                    <div class="stat-label">æˆåŠŸ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value text-danger">${stats.error}</div>
                    <div class="stat-label">é”™è¯¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value text-warning">${stats.loading}</div>
                    <div class="stat-label">æ£€æŸ¥ä¸­</div>
                </div>
            `;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const container = document.getElementById('log-container');
            const logClass = type === 'error' ? 'log-error' :
                           type === 'success' ? 'log-success' :
                           type === 'warning' ? 'log-warning' : '';

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${logClass}`;
            logEntry.innerHTML = `<span>${new Date().toLocaleTimeString()} - ${message}</span>`;

            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            document.getElementById('log-container').innerHTML = '';
            stats = { total: 0, success: 0, error: 0, loading: 0 };
            updateStats();
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ”§ 404é”™è¯¯è¯Šæ–­å·¥å…·åŠ è½½å®Œæˆ', 'info');
            addLog('ğŸ’¡ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ£€æŸ¥èµ„æºçŠ¶æ€', 'info');

            // è‡ªåŠ¨æ£€æŸ¥å½“å‰é¡µé¢çš„èµ„æºåŠ è½½æƒ…å†µ
            setTimeout(() => {
                const scripts = document.scripts;
                const links = document.styleSheets;

                addLog(`ğŸ“Š å½“å‰é¡µé¢å·²åŠ è½½: ${scripts.length} ä¸ªè„šæœ¬, ${links.length} ä¸ªæ ·å¼è¡¨`, 'info');

                // æ£€æŸ¥æ˜¯å¦æœ‰åŠ è½½å¤±è´¥çš„èµ„æº
                const failedResources = [];
                scripts.forEach(script => {
                    if (!script.src || script.src.includes('localhost:3460')) {
                        // è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°èµ„æºï¼Œæ£€æŸ¥æ˜¯å¦åŠ è½½å¤±è´¥
                        if (!script.onload && !script.onerror) {
                            failedResources.push(script.src);
                        }
                    }
                });

                if (failedResources.length > 0) {
                    addLog(`âš ï¸ æ£€æµ‹åˆ° ${failedResources.length} ä¸ªå¯èƒ½å¤±è´¥çš„æœ¬åœ°èµ„æº`, 'warning');
                    failedResources.forEach(src => {
                        addLog(`   - ${src}`, 'warning');
                    });
                }
            }, 1000);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>