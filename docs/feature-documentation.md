# 简庐团队系统 - 功能文档

## 项目概述
简庐团队系统是一个基于UniApp + Express.js的团队管理和活动组织平台，支持用户管理、团队协作、活动组织和微信小程序集成。

## 核心功能

### 1. 用户管理系统
- **用户注册/登录**：支持用户名密码登录和微信一键登录
- **角色权限**：super_admin、admin、user三级权限体系
- **用户状态**：active、inactive、deleted状态管理
- **安全功能**：密码加密、登录尝试限制、账户锁定机制

### 2. 团队管理
- **团队创建**：支持创建不同类型的团队
- **成员管理**：团队成员添加、移除、角色分配
- **权限控制**：基于角色的访问控制

### 3. 活动管理
- **活动类型**：支持多种活动类型（团建、会议、培训等）
- **活动状态**：draft、published、ongoing、completed、cancelled
- **参与管理**：活动报名、参与状态跟踪
- **费用管理**：活动费用分摊、预算控制

### 4. 聚餐活动专项功能
专门为公司领导设计的周末聚餐活动管理功能。

#### 功能特性
- **预算管理**：公司提供固定经费（如1000元）
- **人数控制**：5-10人参与限制（低于5人自动取消，超过10人报名无效）
- **费用分摊**：超出公司预算部分由参与成员AA制分摊
- **自动取消**：报名人数不足时自动取消活动

#### 使用流程
1. **创建聚餐活动**
   - 选择团队（必须是已创建的公司团队）
   - 设置活动信息（时间、地点、描述）
   - 配置参与人数限制（5-10人）
   - 设置公司预算（默认1000元）
   - 预估总费用

2. **费用分摊预览**
   - 系统自动计算费用分摊
   - 显示公司承担部分
   - 显示个人AA部分

3. **活动发布**
   - 发布后团队成员可报名参加
   - 实时监控报名人数
   - 自动检查人数限制

4. **自动取消机制**
   - 报名截止时人数不足5人，自动取消活动
   - 超过10人的报名自动标记为无效

#### API接口
- `POST /api/activities/dinner-party` - 创建聚餐活动
- `GET /api/activities/dinner-party/:id` - 获取聚餐活动详情
- `POST /api/activities/dinner-party/:id/check-cancel` - 检查是否需要取消
- `GET /api/activities/dinner-party/available` - 获取可用聚餐活动

### 5. 微信小程序集成
- **微信登录**：支持微信小程序一键登录
- **用户绑定**：微信用户与系统用户绑定
- **小程序界面**：适配微信小程序的UI界面

## 技术架构

### 后端技术栈
- **Node.js + Express.js**：Web服务器框架
- **Sequelize**：ORM框架，支持MySQL
- **JWT**：用户认证
- **bcryptjs**：密码加密
- **微信API**：微信小程序集成

### 前端技术栈
- **UniApp**：跨平台开发框架
- **Vue.js**：前端框架
- **微信小程序**：发布平台

### 数据库设计
- **users**：用户表
- **teams**：团队表
- **activities**：活动表
- **user_activities**：用户活动关联表

## 部署说明

### 环境要求
- Node.js 14+
- MySQL 5.7+
- 微信小程序开发者账号

### 安装步骤
1. 克隆项目
2. 安装依赖：`npm install`
3. 配置环境变量
4. 运行数据库迁移
5. 启动服务：`npm start`

### 环境变量
```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=jianlu_admin
DB_USER=jianlu_app
DB_PASSWORD=jianlu_app_password_2024
JWT_SECRET=your_jwt_secret
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_secret
```

## 使用指南

### 管理员操作
1. **创建团队**：在系统中创建公司团队
2. **用户管理**：添加团队成员，分配权限
3. **活动审批**：审核和管理团队活动

### 普通用户操作
1. **加入团队**：接受邀请加入团队
2. **参与活动**：报名参加团队活动
3. **查看信息**：查看活动详情和个人参与记录

### 公司领导操作
1. **创建聚餐活动**：使用专项功能创建周末聚餐
2. **设置预算**：配置公司提供的经费
3. **管理参与**：监控报名情况和费用分摊

## 注意事项
- 所有涉及费用的操作都需要谨慎处理
- 微信小程序配置需要正确的AppID和AppSecret
- 用户密码使用bcrypt加密存储
- 系统具有完整的日志记录功能

## 开发规范
- 遵循RESTful API设计规范
- 使用统一的响应格式
- 完整的错误处理机制
- 代码注释和文档齐全