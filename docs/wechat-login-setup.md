# 微信登录配置指南

## 📋 配置步骤

### 1. 获取微信小程序AppID和AppSecret

1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 进入"开发" → "开发管理"
3. 找到"开发设置"页面
4. 复制"AppID"和"AppSecret"

### 2. 配置后端环境变量

编辑 `backend/.env` 文件：

```env
# 微信小程序配置
WECHAT_APP_ID=your_actual_app_id_here
WECHAT_APP_SECRET=your_actual_app_secret_here
```

### 3. 配置微信小程序

1. 打开微信开发者工具
2. 在项目设置中，确保AppID与上面配置的一致
3. 在"开发设置"中配置服务器域名：
   - 添加 `http://192.168.100.4:8081` 到request合法域名

### 4. 重启服务器

```bash
cd backend
npm start
```

### 5. 测试微信登录

1. 清理微信开发者工具缓存
2. 重新编译项目
3. 点击微信登录按钮测试

## 🔍 验证方法

### 成功登录的特征：
- 用户名格式：`wx_` + openid前8位
- 邮箱格式：`wx_` + openid + `@wechat.local`
- profile中包含：`register_method: "wechat"`
- 数据库中会保存真实的wechat_openid

### 与模拟登录的区别：
- **模拟登录**：用户名是"微信用户+随机数字"，ID是固定的"test-user-id"
- **真实登录**：用户名以"wx_"开头，ID是UUID格式，有真实的openid

## 🐛 常见问题

### 1. 配置错误
```
错误：微信登录配置错误，请联系管理员
```
**解决**：检查.env文件中的WECHAT_APP_ID和WECHAT_APP_SECRET是否正确配置

### 2. 微信API错误
```
错误：微信服务暂时不可用，请稍后重试
```
**解决**：检查网络连接，确认AppID和AppSecret有效

### 3. 域名未配置
```
错误：不在以下 request 合法域名列表中
```
**解决**：在微信公众平台配置服务器域名

### 4. 超时错误
```
错误：微信登录超时，请重试
```
**解决**：检查网络连接，重试登录

## 📝 测试步骤

1. **配置验证**：访问测试页面，点击"测试API接口"
2. **功能测试**：点击微信登录按钮
3. **数据验证**：检查登录后的用户信息是否符合真实格式
4. **数据库验证**：确认用户数据正确保存到数据库

## 🔒 安全建议

1. **保护好AppSecret**：不要泄露给任何人
2. **使用环境变量**：不要将密钥硬编码在代码中
3. **定期更换密钥**：建议定期更换AppSecret
4. **监控日志**：关注登录成功率和错误信息