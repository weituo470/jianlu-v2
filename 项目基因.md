# 项目基因 - 关键信息传承

## 🌐 服务器配置
- **端口**: 3459
- **访问地址**: http://localhost:3459
- **API基础路径**: http://localhost:3459/api
- **数据库**: MySQL (jianlu_admin)
- **认证**: JWT Token
- **Token存储**: localStorage.getItem('token')

## 📁 项目架构
```
简庐管理后台系统/
├── backend/                 # 后端服务 (Node.js + Express)
│   ├── src/
│   │   ├── models/         # 数据模型
│   │   ├── routes/         # API路由
│   │   └── app.js          # 主应用 (端口3459)
├── admin-frontend/         # 前端管理界面
├── database/              # 数据库脚本和迁移
└── .kiro/                # Kiro配置和指导文件
```

## 🔧 技术栈
### 后端
- **框架**: Express.js
- **数据库**: MySQL + Sequelize ORM
- **认证**: JWT
- **端口**: 3459

### 前端
- **技术**: 原生JavaScript + Bootstrap
- **架构**: SPA (单页应用)
- **路由**: 自定义路由系统

## 📊 数据库状态
### 已创建的表
- `users` - 用户表
- `teams` - 团队表
- `team_types` - 团队类型表 ✅
- `activities` - 活动表
- `activity_types` - 活动类型表 ✅

### 关键模型
- **User**: 用户模型
- **Team**: 团队模型
- **TeamType**: 团队类型模型 ✅ 已实现
- **Activity**: 活动模型
- **ActivityType**: 活动类型模型 ✅ 已实现

### 当前数据状态
- **团队类型**: 4个 (general, development, other, otherr)
- **活动类型**: 10个默认类型 (meeting, training, workshop等)

## 🚨 已知问题
### 当前待解决
- 暂无

### 已解决问题
1. ✅ ActivityType模型未注册 - 已在models/index.js中注册
2. ✅ Token名称不一致 - 已统一使用'token'
3. ✅ 端口从3000改为3458 - 已更新所有相关文件
4. ✅ **团队创建下拉框为空** - API重复定义导致getTypes方法丢失
   - 问题: admin-frontend/js/api.js中teams对象被定义两次
   - 解决: 删除重复定义，保留包含getTypes方法的完整定义
   - 验证: 数据库有4个团队类型，API正常返回
5. ✅ **小程序API测试账号不一致** - 后端API与小程序前端显示的测试账号不匹配
   - 问题: 后端使用admin/123456，小程序前端显示admin/admin123
   - 解决: 更新后端测试数据，统一使用admin/admin123和testuser/testpass123
   - 验证: 小程序前端现在可以正常使用显示的测试账号登录

## 🎯 开发原则
### 四大核心原则
1. **奥卡姆剃刀** - 如无必要，勿增实体
2. **希波克拉底誓言** - 首先，不造成新的伤害
3. **拒绝局部最优解** - 永远记得当前任务服务于更高目标
4. **先例优先思维** - 先寻找现有的成功模式

### 硬编码规则
- 所有硬编码变量必须加 `-temp` 后缀
- 例如: `const menuItemsTemp = [...]`

## 📈 任务评分机制
### 评分公式
**任务得分 = 10 / X**
- X = 实际工作量 / 标准工作量
- 目标: X尽可能接近1

### 当前评分记录
- 团队类型数据迁移: 2.9分
- 任务复盘机制优化: 8.0分
- 活动类型管理开发: 待评分

## 🔄 最近更新
### 2025-08-12
- ✅ **完成小程序API集成**
  - 实现管理端用户通过账号密码登录微信小程序
  - 提供完整的活动管理、团队管理API接口
  - 修复测试账号不一致问题：统一使用admin/admin123和testuser/testpass123
  - 创建API文档和测试工具：test-miniapp-api.html
- ✅ **升级小程序登录机制**
  - 支持管理后台真实用户登录小程序
  - 优先查询数据库用户，降级到测试数据
  - 完整的密码验证和安全机制 (bcrypt + 账户锁定)
  - 验证：admin用户可使用真实密码登录小程序

### 2025-08-08
- ✅ **修复团队创建下拉框为空问题**
  - 根本原因：认证token过期导致API调用返回401错误
  - 修复方案：
    1. 在TeamManager中添加认证状态检查
    2. 在showCreateModal中添加错误处理和重新登录提示
    3. 在loadTeamTypes中添加认证失败处理
    4. 优化generateTypeOptionsHtml的错误处理
  - 用户体验：当认证失败时自动提示重新登录
  - 清理：删除临时创建的测试页面，保持项目整洁

### 2025-08-07
- ✅ 创建ActivityType完整功能
- ✅ 修复Token认证问题
- ✅ 端口从3000切换到3458

## 💡 重要提醒
### 对新对话窗口的AI
1. **服务端口: 3459**
2. **Token: localStorage.getItem('token')**
3. **严格遵循四大开发原则**
4. **硬编码必须加-temp后缀**
5. **先查看现有实现，再开发新功能**

### 常用命令
```bash
# 启动后端服务
cd backend && npm start

# 数据库迁移
cd database && mysql -u root -p < script.sql

# 访问管理后台
http://localhost:3459
```

---
**更新时间**: 2025-08-07  
**版本**: v1.0