<!DOCTYPE html>
<html>
<head>
    <title>轮播图上传测试</title>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
</head>
<body>
    <h1>轮播图上传测试</h1>
    
    <form id="testForm" enctype="multipart/form-data">
        <div>
            <label>标题：</label>
            <input type="text" name="title" value="测试轮播图" required>
        </div>
        <div>
            <label>图片：</label>
            <input type="file" name="image" accept="image/*" required>
        </div>
        <div>
            <label>状态：</label>
            <select name="status">
                <option value="active">活动</option>
                <option value="inactive">非活动</option>
            </select>
        </div>
        <button type="button" onclick="testUpload()">测试上传</button>
    </form>

    <div id="result"></div>

    <script>
        function testUpload() {
            console.log('=== 开始测试上传 ===');
            
            // 检查API对象
            console.log('1. API对象检查:');
            console.log('  window.API:', typeof window.API, window.API);
            console.log('  window.API.upload:', typeof window.API?.upload);
            console.log('  window.API.banners:', typeof window.API?.banners);
            console.log('  window.API.banners.create:', typeof window.API?.banners?.create);
            
            // 获取表单数据
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            
            console.log('2. FormData内容:');
            for (let [key, value] of formData.entries()) {
                console.log(`  ${key}:`, value);
            }
            
            // 测试API调用
            if (window.API && window.API.banners && window.API.banners.create) {
                console.log('3. 调用 window.API.banners.create');
                window.API.banners.create(formData)
                    .then(response => {
                        console.log('✅ 成功:', response);
                        document.getElementById('result').innerHTML = 
                            '<div style="color: green;">✅ 上传成功: ' + JSON.stringify(response) + '</div>';
                    })
                    .catch(error => {
                        console.error('❌ 失败:', error);
                        document.getElementById('result').innerHTML = 
                            '<div style="color: red;">❌ 上传失败: ' + error.message + '</div>';
                    });
            } else {
                console.log('3. API不可用，使用直接fetch');
                const token = localStorage.getItem('token');
                console.log('  token:', token ? '有' : '无');
                
                fetch(`${AppConfig.API_BASE_URL}/banners`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(response => {
                    console.log('✅ 成功:', response);
                    document.getElementById('result').innerHTML = 
                        '<div style="color: green;">✅ 直接fetch成功: ' + JSON.stringify(response) + '</div>';
                })
                .catch(error => {
                    console.error('❌ 失败:', error);
                    document.getElementById('result').innerHTML = 
                        '<div style="color: red;">❌ 直接fetch失败: ' + error.message + '</div>';
                });
            }
        }
        
        // 页面加载完成后执行检查
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== 页面加载完成 ===');
            console.log('AppConfig:', AppConfig);
            console.log('Utils:', typeof Utils);
            console.log('API:', typeof window.API);
            
            // 设置测试token（如果没有的话）
            if (!localStorage.getItem('token')) {
                console.log('设置测试token');
                localStorage.setItem('token', 'test-token');
            }
        });
    </script>
</body>
</html>